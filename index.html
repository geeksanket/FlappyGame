<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird by Sanket â€” with Music Selector</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Arial,Helvetica,sans-serif;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      height:100vh;overflow:hidden;position:relative;
      background:linear-gradient(to bottom,#4ec0ca,#87ceeb);
      transition:background 2s ease;
    }
    canvas{
      border:3px solid #333;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.3);
      background:linear-gradient(to bottom,#9be2fe,#67d1fb);
      transition:background 2s ease;display:block;
    }
    .topbar{position:absolute;top:12px;left:50%;transform:translateX(-50%);display:flex;gap:12px;align-items:center;z-index:30}
    .score{color:#fff;font-weight:700;font-size:26px;text-shadow:2px 2px 6px rgba(0,0,0,.5)}
    .music-select{color:#fff;font-weight:700}
    .music-select select{padding:6px 10px;border-radius:8px;border:none;background:#4ec0ca;color:#fff;font-weight:700}
    .instructions{position:absolute;bottom:16px;color:#fff;font-size:18px;text-shadow:2px 2px 4px rgba(0,0,0,.4)}
    .game-over{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.85);color:#fff;padding:28px;border-radius:14px;text-align:center;display:none;z-index:50}
    .game-over h2{color:#ff6b6b;margin-bottom:8px}
    .game-over button{margin-top:12px;padding:10px 20px;border-radius:8px;border:none;background:#4ec0ca;color:#fff;font-weight:700;cursor:pointer}
    .social-links{position:fixed;left:12px;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.45);padding:12px 16px;border-radius:12px;color:#fff;text-align:center;z-index:40}
    .social-links a{display:block;color:#ffb3ec;text-decoration:none;font-weight:700;margin:6px 0}
    @media(max-width:600px){.social-links{position:static;transform:none;margin-top:10px}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="score">Score: <span id="score">0</span></div>
    <div class="music-select">
      ðŸŽµ
      <label for="music">Music:</label>
      <select id="music">
        <option value="newsoul.mp3">NEWSOUL</option>
        <option value="edmbg.mp3">EDM</option>
        <option value="chillbg.mp3">CALM</option>
      </select>
    </div>
  </div>

  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div class="instructions">Tap or press SPACE to flap!</div>

  <div class="game-over" id="gameOver">
    <h2>Game Over!</h2>
    <p>Final Score: <span id="finalScore">0</span></p>
    <p>High Score: <span id="highScore">0</span></p>
    <button onclick="restartGame()">Play Again</button>
  </div>

  <div class="social-links">
    <p>Connect ðŸ‘‡</p>
    <a href="https://www.instagram.com/unwellsanket/" target="_blank">Instagram</a>
    <a href="https://github.com/geeksanket" target="_blank">GitHub</a>
    <a href="https://www.linkedin.com/in/paradkarsanket/" target="_blank">LinkedIn</a>
  </div>

  <script>
    // --- basic refs
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const gameOverDiv = document.getElementById('gameOver');
    const finalScoreEl = document.getElementById('finalScore');
    const highScoreEl = document.getElementById('highScore');
    const musicSel = document.getElementById('music');

    // --- assets (place these in same folder)
    const birdImg = new Image();
    birdImg.src = 'modibird.png'; // <-- make sure exists

    const flapSound = new Audio('huh.mp3');
    const hitSound = new Audio('laugh.mp3');
    const scoreSound = new Audio('yipee.mp3');

    // background music object (we'll switch src)
    let bgMusic = new Audio(musicSel.value);
    bgMusic.loop = true;
    bgMusic.volume = 1.0;

    // --- game state
    let bird = { x:80, y:250, w:34, h:24, vel:0, gravity:0.5, jump:-8 };
    let pipes = [];
    let score = 0, highScore = 0;
    let frame = 0, gameRunning = false, gameStarted = false;

    // --- gradient phases
    const gradientPhases = [
      { top:'#4ec0ca', bottom:'#87ceeb' }, // morning
      { top:'#f5af19', bottom:'#f12711' }, // sunset
      { top:'#1e3c72', bottom:'#2a5298' }, // night
      { top:'#ff9966', bottom:'#ff5e62' }  // dawn
    ];

    function hexBlend(a,b,t){
      const n1 = parseInt(a.slice(1),16);
      const n2 = parseInt(b.slice(1),16);
      const r = Math.floor(((n1>>16)*(1-t))+((n2>>16)*t));
      const g = Math.floor((((n1>>8)&0xff)*(1-t))+(((n2>>8)&0xff)*t));
      const bl = Math.floor(((n1&0xff)*(1-t))+((n2&0xff)*t));
      return `rgb(${r},${g},${bl})`;
    }

    function updateBackground(){
      const phaseTime = 600; // larger => slower transition
      const i = Math.floor((frame/phaseTime) % gradientPhases.length);
      const next = (i+1) % gradientPhases.length;
      const t = (frame % phaseTime) / phaseTime;
      const topBlend = hexBlend(gradientPhases[i].top, gradientPhases[next].top, t);
      const bottomBlend = hexBlend(gradientPhases[i].bottom, gradientPhases[next].bottom, t);
      document.body.style.background = `linear-gradient(to bottom, ${topBlend}, ${bottomBlend})`;
      canvas.style.background = `linear-gradient(to bottom, ${bottomBlend}, ${topBlend})`;
    }

    // --- draw helpers
    function drawBird(){ ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h); }

    function drawPipes(){
      ctx.fillStyle = '#2ecc71';
      pipes.forEach(p=>{
        ctx.fillRect(p.x,0,60,p.top);
        ctx.fillRect(p.x,p.top+150,60,canvas.height - p.top - 150);
      });
    }

    function drawGround(){
      ctx.fillStyle = '#8b4513';
      ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
    }

    function updateBird(){
      bird.vel += bird.gravity;
      bird.y += bird.vel;
      if(bird.y + bird.h > canvas.height - 50) endGame();
      if(bird.y < 0) bird.y = 0;
    }

    function updatePipes(){
      if(frame % 100 === 0){
        const top = Math.random() * (canvas.height - 250) + 50;
        pipes.push({ x:canvas.width, top, scored:false});
      }
      pipes.forEach(p=>{
        p.x -= 2;
        if(!p.scored && p.x + 60 < bird.x){
          p.scored = true;
          score++; scoreEl.textContent = score;
          scoreSound.currentTime = 0; scoreSound.play().catch(()=>{});
        }
        // collision
        if(bird.x + bird.w > p.x && bird.x < p.x + 60 && (bird.y < p.top || bird.y + bird.h > p.top + 150)){
          hitSound.play().catch(()=>{});
          endGame();
        }
      });
      pipes = pipes.filter(p => p.x + 60 > 0);
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawPipes();
      drawBird();
      drawGround();
      if(!gameStarted){
        ctx.fillStyle = 'rgba(0,0,0,0.45)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = '28px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Tap or Press SPACE to Start!', canvas.width/2, canvas.height/2);
      }
    }

    function gameLoop(){
      if(gameRunning){
        updateBird();
        updatePipes();
      }
      updateBackground();
      draw();
      frame++;
      requestAnimationFrame(gameLoop);
    }

    // --- flap + controls
    let lastFlap = 0;
    function flap(){
      const now = Date.now();
      if(now - lastFlap < 120) return;
      lastFlap = now;
      if(!gameStarted){
        gameStarted = true; gameRunning = true;
        // attempt to play music if unlocked
        bgMusic.play().catch(()=>{});
      }
      if(gameRunning){
        bird.vel = bird.jump;
        flapSound.currentTime = 0; flapSound.play().catch(()=>{});
      }
    }

    document.addEventListener('keydown', e=>{
      if(e.code === 'Space'){ e.preventDefault(); flap(); }
    });
    canvas.addEventListener('click', flap);
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); flap(); }, {passive:false});

    function endGame(){
      gameRunning = false;
      if(score > highScore) highScore = score;
      finalScoreEl.textContent = score;
      highScoreEl.textContent = highScore;
      gameOverDiv.style.display = 'block';
    }

    function restartGame(){
      bird.y = 250; bird.vel = 0; pipes = []; score = 0; scoreEl.textContent = score;
      gameOverDiv.style.display = 'none'; gameStarted = false; gameRunning = false;
      bgMusic.currentTime = 0;
      bgMusic.play().catch(()=>{});
    }

    // --- music selector handling
    musicSel.addEventListener('change', ()=>{
      const chosen = musicSel.value;
      // swap bgMusic source safely
      const wasPlaying = !bgMusic.paused && !bgMusic.ended && bgMusic.currentTime > 0;
      bgMusic.pause();
      bgMusic = new Audio(chosen);
      bgMusic.loop = true;
      bgMusic.volume = 1.0;
      // if the game already started (user tapped) keep music playing
      if(gameStarted || wasPlaying){
        bgMusic.play().catch(err => {
          // autoplay blocked: will play after next user gesture
          console.log('bgMusic play blocked:', err);
        });
      }
    });

    // --- unlock audio for mobile (plays then pause to "unlock")
    function unlockAudio(){
      // ensure current bgMusic obj is attempted to unlock too
      [bgMusic, flapSound, hitSound, scoreSound].forEach(a=>{
        try{
          a.play().then(()=>{ a.pause(); a.currentTime = 0; }).catch(()=>{});
        }catch(e){}
      });
    }
    document.addEventListener('click', unlockAudio, { once:true });
    document.addEventListener('touchstart', unlockAudio, { once:true });

    // start loop
    gameLoop();

    // --- debug: helpful console note
    console.log('Flappy loaded â€” music selector present. Make sure these files exist: modibird.png, edmbg.mp3, newsoul.mp3, chillbg.mp3, huh.mp3, laugh.mp3, yipee.mp3');
  </script>
</body>
</html>
